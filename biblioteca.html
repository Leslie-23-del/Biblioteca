<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Biblioteca Clásica</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Libre+Baskerville&display=swap" rel="stylesheet">

<script src="https://unpkg.com/epubjs/dist/epub.min.js"></script>

<style>
body{
  margin:0;
  font-family:'Libre Baskerville', serif;
  background:linear-gradient(180deg,#2b1d12,#1a120b);
  color:#f5f1ea;
}

header{
  background:#3a2616;
  padding:2rem;
  text-align:center;
  border-bottom:4px solid #c9a35d;
}

header h1{
  font-family:'Playfair Display', serif;
  font-size:2.8rem;
  color:#f1e4c3;
}

main{
  padding:3rem 2rem;
  max-width:1200px;
  margin:auto;
}

.estante h2{
  font-family:'Playfair Display', serif;
  color:#e6d3a3;
}

.libros{
  display:flex;
  gap:10px;
  background:#2a1b10;
  padding:1.5rem;
  border-radius:12px;
  overflow-x:auto;
}

.libro{
  writing-mode:vertical-rl;
  background:linear-gradient(180deg,#7b4a1f,#4a2c12);
  color:#f1e4c3;
  padding:1rem .5rem;
  height:180px;
  width:40px;
  text-align:center;
  border-radius:6px;
  cursor:pointer;
  transition:.3s;
}

.libro:hover{
  transform:translateY(-10px);
  background:linear-gradient(180deg,#c9a35d,#8a5a2b);
  color:#2b1d12;
}

/* MODAL */
#modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  justify-content:center;
  align-items:center;
  z-index:999;
}

#contenedor{
  background:#1a120b;
  width:80%;
  max-width:900px;
  padding:1rem;
  border-radius:12px;
}

#lector{
  margin-top:1rem;
  height:70vh;
  background:#fff;
}
</style>
</head>

<body>

<header>
  <h1>Biblioteca Clásica</h1>
  <p>Conocimiento, historia y sabiduría preservados en el tiempo</p>
</header>

<main>
  <section class="estante">
    <h2>Romance</h2>
    <div class="libros">
      <div class="libro" onclick="abrirLibro('epubs/romance.epub')">Romance oscuro</div>
      <div class="libro" onclick="abrirLibro('epubs/belleza.epub')">Belleza oscura</div>
    </div>
  </section>
</main>

<!-- MODAL EPUB -->
<div id="modal">
  <div id="contenedor">
    <button onclick="cerrar()">Cerrar</button>
    <button onclick="prev()">◀</button>
    <button onclick="next()">▶</button>
    <div id="lector"></div>
  </div>
</div>

<script>
let book = null;
let rendition = null;

function abrirLibro(ruta){
  // 1️⃣ Mostrar modal ANTES
  document.getElementById("modal").style.display = "flex";

  // 2️⃣ Limpiar lector
  document.getElementById("lector").innerHTML = "";

  // 3️⃣ Crear libro
  book = ePub(ruta);

  // 4️⃣ Renderizar con contenedor visible
  rendition = book.renderTo("lector", {
    width: "100%",
    height: "100%"
  });

  // 5️⃣ Mostrar contenido
  book.ready.then(() => {
    rendition.display();
  });
}

function cerrar(){
  document.getElementById("modal").style.display = "none";
  if(book){
    book.destroy(); // ✅ corregido
    book = null;
  }
}

function next(){
  if(rendition) rendition.next();
}

function prev(){
  if(rendition) rendition.prev();
}
</script>

</body>
</html>
